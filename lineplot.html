<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <style type="text/css">

body {
  font: 300 36px "Helvetica Neue";
  width: 100%;
  overflow-x: hidden;
  position: relative;

}

blockquote:before {
  content: "“";
  position: absolute;
  left: -.4em;
}

blockquote:after {
  content: "”";
  position: absolute;
}

h2 {
  font-size: 24px;
}

svg {
  font-size: 14px;
}

.foreground path {
  fill: none;
  stroke-opacity: 1;
  stroke-width: 1.5px;
}

.foreground path.fade {
  stroke: #000;
  stroke-opacity: .05;
}

.legend {
  font-size: 18px;
  font-style: oblique;
}

.legend line {
  stroke-width: 2px;
}

.brush .extent {
  fill-opacity: .3;
  stroke: #fff;
  shape-rendering: crispEdges;
}

.axis line, .axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}


.axis text {
  text-shadow: 0 1px 0 #fff;
  cursor: move;
}

    </style>
  </head>
  <body>
    <svg></svg>
    <h2>
      Lineplot
    </h2>
    <input type='file' class='data-file'>

    <script type="text/javascript" src="js/d3.js"></script>

    <script type="text/javascript">

function getType(d) {
  if (typeof(d) === 'string'){
    return 'string'
  } else if (typeof(d) === 'number') {
    return 'number'
  } else if (d.constructor.name === 'Date'){
    return 'date'
  } else {
    console.log(d.constructor.name, 'could not be indentified.')
    return 'ignore'
  }
};

var m = [80, 160, 100, 160],
    w = window.innerWidth - m[1] - m[3],
    h = window.innerHeight - m[0] - m[2];

var svg_c = d3.select("svg")
    .attr("width", w + m[1] + m[3])
    .attr("height", h + m[0] + m[2])

var df = d3.select('.data-file')
            .on('input', function(){
              var file = this.files[0];
              var reader = new FileReader();
              reader.onload = function(e){
                console.log('loaded')
                parallel_plot(d3.csvParse(e.target.result, d3.autoType))
              };
              reader.readAsText(file);
              console.log('inpt')
            })

// Load default data
d3.csv("datafiles/td1.csv", d3.autoType).then(line_plot)

function line_plot (data) {
    console.log(data)

    svg_c.selectAll('*').remove()

    var svg = svg_c.append("svg:g")
        .attr("transform", "translate(" + m[3] + "," + m[0] + ")");

    var traits = d3.keys(data[0]).slice(1);

    //reform data into individual dataseries
    data = traits.map(function (t){
      return {trait:t,
              traitType: getType(data[0][t]),
              dat:data.map(d => ({date: d['Date'], val: d[t]}))
             }
    })

    console.log(data.map(d => [d.trait, d.traitType]))
    console.log(data)

    ydomain = d3.extent([].concat(...data.map( d => d.dat.map( d => d.val ) )))
    xdomain = d3.extent([].concat(...data.map( d => d.dat.map( d => d.date ) )))

    console.log(ydomain, xdomain)

    var x = d3.scaleTime()
                   .domain(xdomain)
                   .range([0, w]);

    var y = d3.scaleLinear()
                   .domain(ydomain)
                   .range([h, 0]);

    var color = d3.scaleOrdinal()
                   .domain(traits)
                   .range(d3.schemeCategory10)

  //


  // Returns the path for a given trait.
  var line = d3.line()
              .x(d => x(d.date))
              .y(d => y(d.val))


   // Add foreground lines.
   foreground = svg.append("svg:g")
         .attr("class", "foreground")
       .selectAll("path")
         .data(data)
       .enter().append("svg:path")
         .attr("d", d => line(d.dat))
         .attr("stroke", d => color(d.trait));

   svg.append("g")
       .attr("class", "axis")
       .call(d3.axisLeft(y));

};




    </script>
  </body>
</html>
